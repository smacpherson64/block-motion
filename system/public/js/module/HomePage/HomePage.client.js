import*as Q from"https://esm.sh/react@18.2.0/react.js";import*as V from"https://esm.sh/react-dom@18.2.0/client.js";import*as J from"https://esm.sh/v96/xstate@4.34.0/es2021/xstate.js";import*as ee from"https://esm.sh/v96/hash-wasm@4.9.0/es2021/hash-wasm.js";var e=Q,X=V;var M=(s,t)=>u=>u<s?s:u>t?t:u,I=(s,t)=>u=>u<s?t:u>t?s:u;var d={NE:1,N:2,NW:4,E:8,W:16,SE:32,S:64,SW:128},U=(s,t,u)=>{let n=I(0,t-1),m=I(0,u-1);return s.map(o=>{if(o.type==="base")return o;if(o.type==="unit"){let{row:a,column:p}=o,f=n(a-1),h=n(a+1),r=m(p-1),i=m(p+1);switch(o.direction){case d.NE:return{...o,row:f,column:r};case d.N:return{...o,row:f,column:p};case d.NW:return{...o,row:f,column:i};case d.E:return{...o,row:a,column:r};case d.W:return{...o,row:a,column:i};case d.SE:return{...o,row:h,column:r};case d.S:return{...o,row:h,column:p};case d.SW:return{...o,row:h,column:i};default:return o}}return o})};var H=s=>s.type==="PLACE_BASE",O=s=>s.type==="PLACE_UNIT",K=({theme:s,row:t,column:u})=>{let n=s.blockSize,m=s.blockSize/2,o=u*n,a=t*n,p=o+m,f=a+m,h=p+n*-1,r=p+n,i=f+n*-1,y=f+n,l=M(h,r),b=M(i,y);return{x:o,y:a,cx:p,cy:f,minX:h,maxX:r,minY:i,maxY:y,halfBlock:m,clampX:l,clampY:b}};function j(s){let{theme:t,index:u,emulatedDelta:n,action:m,column:o,row:a,player:p,onActivate:f=()=>{},blocks:h=[]}=s,r=e.useRef(),{y:i,cx:y,cy:l,clampX:b,clampY:Y,halfBlock:k}=e.useMemo(()=>K({row:a,column:o,theme:t}),[a,o,t]),[W,v]=e.useState({x:0,y:0}),w=e.useMemo(()=>n||W,[W,n]),x=e.useMemo(()=>({x:b(y+w.x),y:Y(l+w.y)}),[w.x,w.y,b,Y,y,l]),S=e.useMemo(()=>{let c=x.x<y+k*-1,g=x.x>y+k,E=!c&&!g,P=x.y<l+k*-1,C=x.y>l+k,z=!P&&!C;switch(!0){case(c&&P):return d.NE;case(E&&P):return d.N;case(g&&P):return d.NW;case(c&&z):return d.E;case(g&&z):return d.W;case(c&&C):return d.SE;case(E&&C):return d.S;case(g&&C):return d.SW;case(E&&z):default:return null}},[x.x,x.y,k,y,l]),[$,A]=e.useState(!1),B=e.useMemo(()=>!!n||$,[!!n,$]),_=e.useMemo(()=>h.find(c=>c.type==="base")?"fill-red-500":B?"fill-slate-700":h.find(c=>c.type==="unit")?"fill-white":"fill-transparent",[h,B]);return m==="PLACE_BASE"?e.createElement("g",{className:"relative z-10"},e.createElement("rect",{onClick:()=>{f({type:m,payload:{type:"base",player:p,row:a,column:o}})},width:t.blockSize,height:t.blockSize,x:o*t.blockSize,y:i,radius:"10",className:_})):m==="PLACE_UNIT"?e.createElement("g",{className:"relative z-10"},e.createElement("rect",{onPointerDown:c=>{c.currentTarget.setPointerCapture(c.pointerId),A(!0)},onTouchMove:c=>{if(B){let g=c.touches[0],E=r.current;v({x:E?w.x+g.pageX-E.pageX:0,y:E?w.y+g.pageY-E.pageY:0}),r.current=g}},onTouchEnd:()=>{r.current=void 0},onPointerMove:c=>{B&&v({x:w.x+c.movementX,y:w.y+c.movementY})},onPointerUp:c=>{c.currentTarget.releasePointerCapture(c.pointerId),S&&f({type:"PLACE_UNIT",payload:{type:"unit",player:p,row:a,column:o,direction:S}}),A(!1),v({x:0,y:0})},onPointerCancel:c=>{c.currentTarget.releasePointerCapture(c.pointerId),S!==null&&f({type:"PLACE_UNIT",payload:{type:"unit",player:p,row:a,column:o,direction:S}}),A(!1),v({x:0,y:0})},width:t.blockSize,height:t.blockSize,x:o*t.blockSize,y:i,radius:"10",className:`select-none ${_} touch-manipulation`}),B?e.createElement(e.Fragment,null,e.createElement("path",{strokeLinecap:"round",className:"stroke-2 stroke-gray-400/30 z-10 relative",x:y,y:l,d:`M${y} ${l} L ${x.x} ${x.y} Z`}),e.createElement("circle",{cx:x.x,cy:x.y,r:t.blockSize*.18,className:"fill-gray-700"})):null):e.createElement("rect",{width:t.blockSize,height:t.blockSize,x:o*t.blockSize,y:i,radius:"10",className:_})}var N=(s,{columns:t})=>Math.floor(s/t),T=(s,{columns:t})=>s%t;function L(s){let{theme:t,children:u,players:n,rows:m,columns:o}=s,{height:a,width:p}=e.useMemo(()=>({height:t.blockSize*m,width:t.blockSize*o}),[t.blockSize,m,o]),f=e.useMemo(()=>new Array(m*o).fill(null).map((h,r)=>{let i=N(r,{columns:o}),y=T(r,{columns:o}),l=i*t.blockSize;return e.createElement("rect",{key:r,width:t.blockSize,height:t.blockSize,x:y*t.blockSize,y:l,radius:"10",strokeWidth:t.gap,className:"relative z-0 select-none stroke-slate-800 fill-transparent"})}),[]);return e.createElement("div",{className:"overflow-hidden bg-slate-900 border-2 border-gray-700 rounded-md relative select-none"},e.createElement("svg",{height:a,width:p,viewBox:`0 0 ${p} ${a}`,className:"relative"},n===2?e.createElement("rect",{x:p/2-2.5,y:"0",height:a,width:5,className:"fill-slate-800 z-0"}):null,f,u))}function D(s){let{theme:t,rows:u,columns:n}=s,[m,o]=e.useState([]),[a,p]=e.useState(!1),f=!!m.find(r=>r.type==="base");e.useEffect(()=>{if(a){let r=setInterval(()=>{o(i=>U(i,u,n))},1e3);return()=>clearInterval(r)}},[a]);let h=e.useMemo(()=>new Array(u*n).fill(null).map((r,i)=>{let y=T(i,{columns:n}),l=N(i,{columns:n});return{column:y,row:l}}),[u,n]);return e.createElement(e.Fragment,null,e.createElement(L,{theme:t,rows:u,columns:n,players:1},h.map(({column:r,row:i},y)=>e.createElement(j,{key:`${r}-${i}-${y}`,blocks:m.filter(({row:l,column:b})=>i===l&&r===b),theme:t,index:y,action:f?"PLACE_UNIT":"PLACE_BASE",player:1,row:i,column:r,onActivate:l=>{H(l)&&o(b=>[...b,l.payload]),O(l)&&(m.find(b=>b.type==="unit"&&b.direction===l.payload.direction&&b.row===l.payload.row&&b.column===l.payload.column)||o(b=>[...b,l.payload]))}}))),e.createElement("div",{className:"flex space-x-2 p-2"},e.createElement("button",{type:"button",onClick:()=>{o(r=>U(r,u,n))},className:"p-2 px-3 bg-slate-900 text-white rounded"},"Move Blocks"),e.createElement("button",{type:"button",onClick:()=>{p(r=>!r)},className:"p-2 px-3 bg-slate-900 text-white rounded"},a?"pause":"play")))}var F=5,Z=9,q={gap:1,blockSize:50};function G(){return e.createElement("html",{lang:"en-us",className:"h-full w-full"},e.createElement("head",null,e.createElement("meta",{charSet:"utf-8"}),e.createElement("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),e.createElement("meta",{name:"description",content:"Block motion is a live action strategy game where two players aim blocks at each other's bases."}),e.createElement("title",null,"Block motion \u2B05\uFE0F"),e.createElement("style",null,"body {overflow: hidden !important; -webkit-overflow-scrolling: touch;"),e.createElement("link",{rel:"stylesheet",href:"/public/styles.css"}),e.createElement("link",{rel:"icon",href:"data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>\u2B05\uFE0F</text></svg>"}),e.createElement("script",null),e.createElement("script",{type:"module",src:"/public/js/module/HomePage/HomePage.client.js"}),e.createElement("script",{noModule:!0,src:"/public/js/classic/HomePage/HomePage.client.js"})),e.createElement("body",{className:"bg-slate-800 h-full min-h-screen w-full grid place-items-center text-gray-100"},e.createElement("div",null,e.createElement(D,{theme:q,rows:F,columns:Z}))))}X.hydrateRoot(document,e.createElement(G,null));
//# sourceMappingURL=HomePage.client.js.map
